#summary How to build i-jetty
#labels Featured

=Building i-jetty=
_Updated for i-jetty-2.1_

==From the Command Line==
Building i-jetty at the command line is very straightforward.

You'll need these tools:

 * svn
 * [http://java.sun.com/javase/ java jdk] - 1.5 or above
 * [http://maven.apache.org/ maven] - 2.0.8 or above
 * [http://developer.android.com/sdk/index.html android sdk] installation - 1.6 or above
 * [http://developer.android.com/sdk/adding-components.html platform definition for 1.6 (api version 4)] 

To build:

 # Checkout the code from svn:  `svn co http://i-jetty.googlecode.com/svn/trunk/`
 # Edit your maven [http://maven.apache.org/settings.html settings.xml] file

You should add the following lines to your [http://maven.apache.org/settings.html settings.xml] file, replacing the value of *android.home* with the location of your android sdk:

{{{
<settings>
  <profiles>
    <profile>
      <id>android</id>
      <properties>
        <android.home>/usr/local/java/android-sdk-linux_86</android.home>
      </properties>
    </profile>
  </profiles>
  <activeProfiles>
    <activeProfile>android</activeProfile>
  </activeProfiles>
</settings>
}}}

Then, assuming you checked out the code to $I_JETTY_HOME, and you have the android sdk installed at $ANDROID_HOME, you do:

{{{
 cd $I_JETTY_HOME
 mvn clean install
}}}

Voila! You will have an installable .apk bundle in your `$I_JETTY_HOME/i-jetty-ui/target` directory. Now follow the instructions over at the [http://developer.android.com/ Android Developers] site to upload it to your phone or emulator.

=== Building on Windows ===
Several users have reported memory problems when building on Windows. This can manifest itself as a mysterious and unhelpful error message from the build system.

To avoid this problem, try increasing the amount of memory available to dex during compilation. To do that, edit the $I_JETTY_HOME/i-jetty-ui/pom.xml file and find the line that looks like:
{{{
  <executable>${android.home}/${android-platform}/tools/dx</executable>
}}}

Under that, as the first argument, add this line:

{{{   
<argument>-JXmx1024M</argument>
}}}

===Making an SDCard Image===
i-jetty requires an sd card. If you're running with the emulator, you'll need to use the [http://developer.android.com/guide/developing/tools/othertools.html#mksdcard mksdcard] utility from the [http://developer.android.com/ android sdk]. Here's an example of creating a file called "sdcard.img" which is a card with 60Mb storage:

{{{
mksdcard 60M ./sdcard.img
}}}

When you start the emulator, you can choose which android platform runtime to use, but remember you need to start the emulator with the scard option. Here's an example of starting the 1.6 runtime with the sdcard we created in the step above:
{{{
emulator -avd avd1.6 -sdcard ./sdcard.img
}}}

If you're using the emulator, you'll want to install the ijetty package:
{{{
adb install i-jetty-ui/target/i-jetty-debug-[ijetty.version].apk
}}}

Where ijetty.version is the version number of i-jetty, eg 2.1-SNAPSHOT.

If you want to make changes to i-jetty, you can remove the installed i-jetty with:
{{{
adb uninstall org.mortbay.ijetty
}}}


==Using the Eclipse Plugin==

You can import the i-jetty project into Eclipse. We use the wonderful [http://m2eclipse.codehaus.org/ m2 Eclipse plugin] to make it easy. 

Note: due to some massaging of the i-jetty-server component to comply with the Dalvik JVM running on Android, we advise that you do not have that project open in eclipse, as the [http://developer.android.com/sdk/eclipse-adt.html Eclipse Android Plugin] cannot properly do what's needed to get it working on Android.  The Maven build is what creates the proper i-jetty-server component that i-jetty-ui (and Android) eventually use.

Please contact the i-jetty developers at *dev@jetty.codehaus.org* for help.