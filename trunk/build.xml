<?xml version="1.0" encoding="UTF-8"?>

<project name="i-jetty" default="generate" basedir=".">

  <property name="src"            value="${basedir}/src" />
  <property name="src.gen"        value="${basedir}/src-generated" />
  <property name="jetty"          value="${basedir}/jetty" />
  <property name="patches"        value="${basedir}/patches" />

  <!-- ====================================================================== -->
  <!-- Help target                                                            -->
  <!-- ====================================================================== -->
  <target name="help">
    <echo message="Please run: $ant generate"/>
  </target>

  <!-- ====================================================================== -->
  <!-- generate target                                                        -->
  <!-- ====================================================================== -->
  <target name="generate">
    <echo message="Generating src-generated"/>
    
    <copy todir="${src.gen}">
      <fileset dir="${jetty}/modules/servlet-api-2.5/src/main/java">
        <include name="**/*.java"/>
      </fileset>
      <fileset dir="${jetty}/modules/servlet-api-2.5/src/main/resources">
        <include name="**/**"/>
      </fileset>
      <fileset dir="${jetty}/modules/util/src/main/java">
        <include name="org/mortbay/component/**/*.java"/>
        <include name="org/mortbay/thread/**/*.java"/>
        <include name="org/mortbay/util/**/*.java"/>
        <include name="org/mortbay/log/**/*.java"/>
        <exclude name="org/mortbay/log/**/Slf4jLog.java"/>
        <include name="org/mortbay/servlet/**/*.java"/>
      </fileset>
      <fileset dir="${jetty}/modules/jetty/src/main/java">
        <include name="org/mortbay/**/*.java"/>
      </fileset>
      <fileset dir="${jetty}/modules/jetty/src/main/resources">
        <include name="**/**"/>
      </fileset>
    </copy>
    <patch dir="${src.gen}" patchfile="${patches}/cookie.patch" ignorewhitespace="true" strip="0"/>
    <patch dir="${src.gen}" patchfile="${patches}/genericservlet.patch" ignorewhitespace="true" strip="0"/>
    <patch dir="${src.gen}" patchfile="${patches}/httpservlet.patch" ignorewhitespace="true" strip="0"/>
    <patch dir="${src.gen}" patchfile="${patches}/httputils.patch" ignorewhitespace="true" strip="0"/>
    <patch dir="${src.gen}" patchfile="${patches}/servletoutputstream.patch" ignorewhitespace="true" strip="0"/>
    <patch dir="${src.gen}" patchfile="${patches}/mimetypes.patch" ignorewhitespace="true" strip="0"/>
  </target>

</project>
